当MySQL单表记录数过⼤时，数据库的CRUD性能会明显下降，⼀些常⻅的优化措施如下 

### 限定数据的范围

 务必禁⽌不带任何限制数据范围条件的查询语句。⽐如：我们当⽤户在查询订单历史的时候，我们可以 控制在⼀个⽉的范围内； 

### 读/写分离

 经典的数据库拆分⽅案，主库负责写，从库负责读； 

### 垂直分区

根据数据库⾥⾯数据表的相关性进⾏拆分。 例如，⽤户表中既有⽤户的登录信息⼜有⽤户的基本信 息，可以将⽤户表拆分成两个单独的表，甚⾄放到单独的库做分库。 

简单来说垂直拆分是指数据表列的拆分，把⼀张列⽐较多的表拆分为多张表。 如下图所示，这样来说 ⼤家应该就更容易理解了。  

![](E:\学习资料总结\面试题总结\15MySQL\assets/QQ截图20201227103119.png)

垂直拆分的优点： 可以使得列数据变⼩，在查询时减少读取的Block数，减少I/O次数。此外， 垂直分区可以简化表的结构，易于维护。 

垂直拆分的缺点： 主键会出现冗余，需要管理冗余列，并会引起Join操作，可以通过在应⽤层 进⾏Join来解决。此外，垂直分区会让事务变得更加复杂； 

### ⽔平分区 

保持数据表结构不变，通过某种策略存储数据分⽚。这样每⼀⽚数据分散到不同的表或者库中，达到了 分布式的⽬的。 ⽔平拆分可以⽀撑⾮常⼤的数据量。 

⽔平拆分是指数据表⾏的拆分，表的⾏数超过200万⾏时，就会变慢，这时可以把⼀张的表的数据拆成 多张表来存放。举个例⼦：我们可以将⽤户信息表拆分成多个⽤户信息表，这样就可以避免单⼀表数据 量过⼤对性能造成影响。 ![](E:\学习资料总结\面试题总结\15MySQL\assets/QQ截图20201227103210.png)

⽔平拆分可以⽀持⾮常⼤的数据量。需要注意的⼀点是：分表仅仅是解决了单⼀表数据过⼤的问题，但 由于表的数据还是在同⼀台机器上，其实对于提升MySQL并发能⼒没有什么意义，所以 ⽔平拆分最好分 库 。 

⽔平拆分能够 ⽀持⾮常⼤的数据量存储，应⽤端改造也少，但 分⽚事务难以解决 ，跨节点Join性能 ᫾差，逻辑复杂。《Java⼯程师修炼之道》的作者推荐 尽量不要对数据进⾏分⽚，因为拆分会带来逻 辑、部署、运维的各种复杂度 ，⼀般的数据表在优化得当的情况下⽀撑千万以下的数据量是没有太⼤ 问题的。如果实在要分⽚，尽量选择客户端分⽚架构，这样可以减少⼀次和中间件的⽹络I/O。 

下⾯补充⼀下数据库分⽚的两种常⻅⽅案： 

客户端代理： 分⽚逻辑在应⽤端，封装在jar包中，通过修改或者封装JDBC层来实现。 当当⽹的 Sharding-JDBC 、阿⾥的TDDL是两种⽐᫾常⽤的实现。 

中间件代理： 在应⽤和数据中间加了⼀个代理层。分⽚逻辑统⼀维护在中间件服务中。 我们现 在谈的 Mycat 、360的Atlas、⽹易的DDB等等都是这种架构的实现。 